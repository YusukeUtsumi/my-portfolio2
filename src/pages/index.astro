---
import Hero from "../components/Hero.astro";
import AiTalent from "../components/AiTalent.astro";
import AgentFlow from "../components/AgentFlow.astro";
import PoeticBlock from "../components/PoeticBlock.astro";
import RisaGPTs from "@/components/RisaGPTs.astro";
import Aboutme from "@/components/Aboutme.astro";

/* assets */
import bgNoise from "../assets/bg_noise.webp";
import favicon from "../assets/favicon.svg";

/* global styles */
import "../styles/global.css";
import "../styles/hero.css";
import "../styles/poetic.css";
import "../styles/aitalent.css";
import "../styles/silentguard.css";
import "../styles/agentflow.css";
import "../styles/risagpts.css";
import "../styles/aboutme.css";

/* ✅ scripts をビルド後URLに解決（?url） */
import heroJs from "../scripts/hero.ts?url";
import agentflowJs from "../scripts/agentflow.ts?url";
import risagptsJs from "../scripts/risagpts.ts?url";
import aitalentJs from "../scripts/aitalent.ts?url";
import poeticJs from "../scripts/poetic.ts?url";
---

<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>MeltLight</title>

        <!-- favicon (assets import) -->
        <link rel="icon" type="image/svg+xml" href={favicon.src} />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;300&display=swap"
            rel="stylesheet"
        />

        <style is:global>
            :root {
                --bg-base: #0f0f10;
                --bg-ink: rgba(0, 0, 0, 0.65);
                --noise-opacity: 0.06;
            }
            html,
            body {
                height: 100%;
                background: var(--bg-base);
                color-scheme: dark;
            }
            .bg-noise {
                position: fixed;
                inset: 0;
                z-index: -2;
                pointer-events: none;
                /* background-image はインラインで指定（assetsのURLを使用） */
                background-repeat: repeat;
                background-position: 50% 50%;
                background-size: 480px 480px;
                opacity: var(--noise-opacity);
                image-rendering: auto;
            }
            .bg-vignette {
                position: fixed;
                inset: -20vh;
                z-index: -3;
                pointer-events: none;
                background:
                    radial-gradient(60% 40% at 50% 30%, rgba(255, 255, 255, 0.035), transparent 60%),
                    radial-gradient(120% 90% at 50% 120%, var(--bg-ink), transparent 45%);
                will-change: transform;
            }
            .page section {
                position: relative;
                background: transparent;
            }
            .page section::after {
                content: "";
                position: absolute;
                left: 0;
                right: 0;
                bottom: -1px;
                height: clamp(64px, 8vw, 120px);
                pointer-events: none;
                background: linear-gradient(
                    180deg,
                    transparent 0%,
                    rgba(14, 14, 18, 0.92) 100%
                );
            }
            @media (max-width: 768px) {
                :root { --noise-opacity: 0.05; }
            }
            @media (prefers-reduced-motion: reduce) {
                * { animation: none !important; transition: none !important; }
            }
        </style>
    </head>

    <body>
        <!-- 背景ノイズ（assetsのURLをインラインで適用） -->
        <div
            class="bg-noise"
            style={`background-image:url(${bgNoise.src})`}
        ></div>

        <div class="bg-vignette"></div>

        <main class="page">
            <section>
                <Hero />
                <script type="module" src={heroJs}></script>
            </section>

            <section aria-label="prologue">
                <PoeticBlock
                    lines={[
                        "計算の夢がほどけ、",
                        "一輪の現実がこちらを向く。",
                        "The dream unknits,",
                        "and reality turns its face."
                    ]}
                    align="center"
                    tone="dim"
                />
            </section>

            <section aria-label="agentflow">
                <AgentFlow />
                <script type="module" src={agentflowJs}></script>
            </section>

            <section aria-label="risagpts">
                <RisaGPTs />
                <script type="module" src={risagptsJs}></script>
            </section>

            <section aria-label="transition">
                <PoeticBlock
                    lines={[
                        "二つの極が、境界の声を生む。",
                        "Two poles give birth to a voice at the boundary."
                    ]}
                    align="center"
                    tone="bright"
                />
            </section>

            <section aria-label="ai-talent">
                <AiTalent />
                <script type="module" src={aitalentJs}></script>
            </section>

            <section aria-label="finale">
                <PoeticBlock
                    lines={[
                        "カーネーションは光を問う。",
                        "The carnation questions the light."
                    ]}
                    align="center"
                    tone="dim"
                />
            </section>

            <section aria-label="end">
                <PoeticBlock
                    lines={[
                        "北を目指すか、それとも南か？",
                        "Do you seek the North, or drift toward the South?"
                    ]}
                    align="center"
                    tone="dim"
                />
            </section>

            <Aboutme />

            <!-- フェードイン演出 -->
            <script type="module" src={poeticJs}></script>
        </main>
    </body>
</html>
