---
import Hero from "../components/Hero.astro";
import AiTalent from "../components/AiTalent.astro";
import SilentGuard from "../components/SilentGuard.astro";
import AgentFlow from "../components/AgentFlow.astro";
import PoeticBlock from "../components/PoeticBlock.astro";
import RisaGPTs from "@/components/RisaGPTs.astro";
import Aboutme from "@/components/Aboutme.astro";
---

<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>MeltLight</title>
        <link rel="icon" href="/images/favicon.svg" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;300&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/src/styles/global.css" />
        <link rel="stylesheet" href="/src/styles/hero.css" />
        <link rel="stylesheet" href="/src/styles/poetic.css" />
        <link rel="stylesheet" href="/src/styles/aitalent.css" />
        <link rel="stylesheet" href="/src/styles/silentguard.css" />
        <link rel="stylesheet" href="/src/styles/agentflow.css" />
        <link rel="stylesheet" href="/src/styles/risagpts.css"/>
        <link rel="stylesheet" href="/src/styles/aboutme.css"/>

        <!-- ページ共通 背景／ノイズを index 側で一元管理 -->
        <style is:global>
            :root {
                /* 全ページの暗部トーンを統一 */
                --bg-base: #0f0f10;
                --bg-ink: rgba(0, 0, 0, 0.65);
                --noise-opacity: 0.06; /* 0.04–0.08 推奨 */
            }
            html, body {
                height: 100%;
                background: var(--bg-base);
                color-scheme: dark;
            }
            /* 背景ノイズ（固定・全画面） */
            .bg-noise {
                position: fixed;
                inset: 0;
                z-index: -2;
                pointer-events: none;
                background-image: url("../images/bg_noise.webp");
                background-repeat: repeat;
                background-position: 50% 50%;
                background-size: 480px 480px; /* 細かすぎたら 640px へ */
                opacity: var(--noise-opacity);
                image-rendering: auto;
            }
            /* ビネット／奥行き（ごく薄く） */
            .bg-vignette {
                position: fixed;
                inset: -20vh;
                z-index: -3;
                pointer-events: none;
                background:
                    radial-gradient(60% 40% at 50% 30%, rgba(255, 255, 255, 0.035), transparent 60%),
                    radial-gradient(120% 90% at 50% 120%, var(--bg-ink), transparent 45%);
                /* スクロール連動の視差を避けて常に安定 */
                will-change: transform;
            }
            /* セクション間の“継ぎ目”が見えない余白（上下フェザー用の薄い重なり） */
            .page section {
                    position: relative;
                background: transparent; /* 各セクションCSSの背景は削除/透明に */
            }
            .page section::after {
                content: "";
                position: absolute;
                left: 0;
                right: 0;
                bottom: -1px;
                height: clamp(64px, 8vw, 120px);
                pointer-events: none;
                background: linear-gradient(180deg, transparent 0%, rgba(14, 14, 18, 0.92) 100%);
                /* 各セクションの“下端”だけ軽くフェザー。上端はページ背景が拾う */
            }
            /* モバイルの背景粗密が強すぎる時に少し抑える */
            @media (max-width: 768px) {
                :root { --noise-opacity: 0.05; }
            }
            @media (prefers-reduced-motion: reduce) {
                * { animation: none !important; transition: none !important; }
            }
        </style>
    </head>

    <body>
        <!-- 背景レイヤー（全ページ共通） -->
        <div class="bg-noise"></div>
        <div class="bg-vignette"></div>

        <!-- コンテンツ -->
        <main class="page">
            <section>
                <Hero />
                <script type="module" src="/src/scripts/hero.ts"></script>
            </section>

            <!-- ① Hero と AIタレントの間：序章の詩 -->
            <section aria-label="prologue">
                <PoeticBlock
                    lines={[
                        "計算の夢がほどけ、",
                        "一輪の現実がこちらを向く。",
                        "The dream unknits,",
                        "and reality turns its face."
                    ]}
                    align="center"
                    tone="dim"
                />
            </section>

            <section aria-label="agentflow">
                <AgentFlow />
                <script type="module" src="/src/scripts/agentflow.ts"></script>
            </section>

            <section aria-label="risagpts">
                <RisaGPTs />
                <script type="module" src="/src/scripts/risagpts.ts"></script>
            </section>

            <!-- ② AIタレント と 個人開発の間：遷移の詩 -->
            <section aria-label="transition">
                <PoeticBlock
                    lines={[
                        "二つの極が、境界の声を生む。",
                        "Two poles give birth to a voice at the boundary."
                    ]}
                    align="center"
                    tone="bright"
                />
            </section>

            <section aria-label="ai-talent">
                <AiTalent />
                <script type="module" src="/src/scripts/aitalent.ts"></script>
            </section>

            <!-- ③ 終幕の詩：ラスト -->
            <section aria-label="finale">
                <PoeticBlock
                    lines={[
                        "カーネーションは光を問う。",
                        "The carnation questions the light."
                    ]}
                    align="center"
                    tone="dim"
                />
            </section>

            <!-- ④ 終幕の詩：問い -->
            <section aria-label="end">
                <PoeticBlock
                    lines={[
                        "北を目指すか、それとも南か？",
                        "Do you seek the North, or drift toward the South?"
                    ]}
                    align="center"
                    tone="dim"
                />
            </section>

            <Aboutme />

            <!-- Poetic のフェードイン -->
            <script type="module" src="/src/scripts/poetic.ts"></script>
        </main>
    </body>
</html>
